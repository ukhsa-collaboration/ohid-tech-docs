<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>AWS Networking - OHID Technical Documentation</title>

    <link href="../../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://ukhsa-collaboration.github.io/ohid-tech-docs/documentation/aws/networking.html">

      <meta name="robots" content="noindex" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="ukhsa-collaboration.github.io" />
      <meta name="twitter:image" content="https://ukhsa-collaboration.github.io/ohid-tech-docs/images/govuk-large.png" />
      <meta name="twitter:title" content="AWS Networking - OHID Technical Documentation" />
      <meta name="twitter:url" content="https://ukhsa-collaboration.github.io/ohid-tech-docs/documentation/aws/networking.html" />

      <meta property="og:image" content="https://ukhsa-collaboration.github.io/ohid-tech-docs/images/govuk-large.png" />
      <meta property="og:site_name" content="OHID Technical Documentation" />
      <meta property="og:title" content="AWS Networking" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://ukhsa-collaboration.github.io/ohid-tech-docs/documentation/aws/networking.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://ukhsa-collaboration.github.io/ohid-tech-docs" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          OHID Technical Documentation
        </span>
      </a>
        <strong class="govuk-tag">internal</strong>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="../../">Home</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ukhsa-collaboration/ohid-tech-docs">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://ukhsa-collaboration.github.io/ohid-tech-docs"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#aws-networking"><span>AWS Networking</span></a>
    <ul>
      <li>
        <a href="#account-specific"><span>Account specific</span></a>
      </li>
      <li>
        <a href="#egress"><span>Egress</span></a>
      </li>
      <li>
        <a href="#ingress"><span>Ingress</span></a>
      </li>
      <li>
        <a href="#additional-reading"><span>Additional reading</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content" tabindex="0">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="aws-networking">AWS Networking</h1>
<h2 id="account-specific">Account specific</h2>
<p>Account networking is created and managed by Terraform inside each workload account. The common result is one VPC per account with at least public and private subnets across multiple availability zones.</p>
<p>When creating a new account:</p>

<ul>
<li>Keep CIDR ranges non-overlapping.</li>
<li>Leave headroom for future service growth.</li>
<li>Enable flow logs on your VPC and ship them to the Log Archive account.</li>
</ul>
<p>We should consider moving CIDR management to AWS IPAM should reduce manual coordination and the risk of overlap.</p>
<h2 id="egress">Egress</h2>
<p>Except for VPC endpoints, egress traffic originating from private subnets is routed over a Transit Gateway attachment and into the Networking account where it uses the Networking account&rsquo;s NAT gateways to reach the Internet.</p>
<p>Where possible, use VPC endpoints for AWS services (for example S3) so traffic does not need to traverse NAT.</p>
<p>Transit Gateway is not in the datapath for normal internet ingress and response traffic (See Ingress section below).</p>
<h3 id="architecture">Architecture</h3>
<p><a href="../../images/aws-centralised-egress-diagram.png" rel="noopener noreferrer"><img src="../../images/aws-centralised-egress-diagram.png" alt="Diagram of centralised egress" /></a></p>
<h2 id="ingress">Ingress</h2>
<p>Unlike internet egress, service accounts take a decentralised approach to ingress and expose entry points at individual account level.</p>
<p>Ingress flow differs slightly by entry point:</p>

<ul>
<li><code>ALB</code> pattern: client traffic enters via the VPC Internet Gateway and is terminated at the ALB. The ALB then opens a new connection to the target in private subnets (for example ECS tasks). Response traffic returns to the ALB and then back to the client through the Internet Gateway.</li>
<li><code>API Gateway</code> pattern: TLS is terminated by API Gateway at the edge/regional service layer. API Gateway then invokes the backend integration (for example Lambda)</li>
</ul>
<p>Standard expectations:</p>

<ul>
<li>Keep application compute/data planes in private subnets.</li>
<li>Use ALB + AWS WAF as the default ingress pattern for public-facing services.</li>
<li>Use API Gateway for API-first services where its features are needed (for example request validation, authorizers, usage plans, or throttling controls).</li>
<li>If NLB is required, document the rationale and apply compensating controls because WAF cannot be attached directly to NLB.</li>
<li>Restrict inbound ports and source ranges with security groups.</li>
<li>Keep DNS and certificate ownership explicit per service/environment.</li>
<li>Default to one ALB per account; only add more where there is a clear operational or security reason.</li>
<li>Access to databases should always be through SSM and through SSH tunnels.</li>
</ul>
<h2 id="additional-reading">Additional reading</h2>

<ul>
<li>https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/using-nat-gateway-for-centralized-egress.html</li>
<li>https://docs.aws.amazon.com/prescriptive-guidance/latest/transitioning-to-multiple-aws-accounts/decentralized-ingress.html</li>
<li>https://github.com/ukhsa-collaboration/ohid-networks-iac</li>
</ul>

            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ukhsa-collaboration/ohid-tech-docs/blob/main/source/documentation/aws/networking.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ukhsa-collaboration/ohid-tech-docs/issues/new?body=Problem+with+%27AWS+Networking%27+%28https%3A%2F%2Fukhsa-collaboration.github.io%2Fohid-tech-docs%2Fdocumentation%2Faws%2Fnetworking.html%29&amp;labels=bug&amp;title=Re%3A+%27AWS+Networking%27">Report problem</a></li>
                <li><a href="https://github.com/ukhsa-collaboration/ohid-tech-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../../javascripts/application.js"></script>
  </body>
</html>
